---
layout: post
title: Git 分支
categories: 版本控制
---


### 1. 分支简介

Git 保存的不是文件的变化或者差异，而是一系列不同时刻的快照。在提交时，Git 会保存一个提交对象 (commit object)。该提交对象包含一个指向暂存内容快照的指针、指向它的父对象的指针。

**暂存操作**会为每一个文件计算校验和 (SHA-1 算法)，并把当前版本的文件快照保存到 Git 仓库中 (blob 对象)。最终将校验和加入到暂存区域等待提交。

**提交操作**时，Git 会先计算每一个子目录的校验和，然后在 Git 仓库中将这些校验和保存为树对象。随后，Git 便会创建一个**提交对象**， 它除了包含上面提到的那些信息外，还包含指向这个树对象（项目根目录）的指针。 

**Git 分支，本质上是指向提交对象的可变指针。**Git 的默认分支名字是 master。Git 创建分支时，只是创建了一个可以移动的新的指针。Git 利用特殊指针 HEAD 来指示当前在哪一个分支上。HEAD 指针指向当前所在的本地分支，为当前分支的别名。

分支切换所做的事：
1. 使 HEAD 移动到新的分支
2. 将工作目录**恢复**成新的分支所指向的快照内容

**分支切换会改变工作目录中的文件**

分支有关的命令：
* 当前分支的列表：git branch
* 创建分支：git branch 分支名
* 查看各个分支当前所指的对象：git log --decorate
    - 查看分支历史：git log --oneline --decorate --graph --all
* 切换分支：git checkout 分支名
* 创建新分支并切换过去：git checkout -b 新分支名

### 2. 分支的新建与合并

* 合并分支：git merge 分支名
* 删除分支：git branch -d 分支名
* 解决冲突的图形化工具：git mergetool


fast-forward：当你试图合并两个分支时， 如果顺着一个分支走下去能够到达另一个分支，那么 Git 在合并两者的时候， 只会简单的将指针向前推进（指针右移），因为这种情况下的合并操作没有需要解决的分歧

三方合并：当一个分支不是另一个分支的直接祖先，Git 会使用两个分支的末端所指的快照及公共祖先，做三方合并。Git 会创建一个新的快照，自动创建新的提交，叫做**合并提交**，该提交有不止一个父提交。

**合并冲突**：在不同分支中，对同一文件的同一个部分进行了不同的修改，导致没法合并。

未合并状态：因包含合并冲突而有待解决的文件

### 3. 分支开发工作流

长期分支：
* 同时拥有多个开放的分支，定期的把某些分支合并入其他分支中
* 例如，在 master 分支上保留完全稳定的代码，在 develop 分支上做后续开发

主题分支：
* 短期分支，实现单一特性或相关工作
* 多次创建、使用、合并、删除分支

### 4. 远程分支：

* **远程引用**是对**远程仓库**的引用，包括分支、标签等
* origin 是当你运行 git clone 时默认的远程仓库名字
* 添加远程仓库引用：git remote add \<remote>
* 使用 git ls-remote \<remote> 来显式的获得远程引用的完整列表。
* 使用 git remote show \<remote> 获得远程分支的具体信息

* **远程跟踪分支**是远程分支状态的引用，以 \<remote>/\<branch> 命名，该分支在远程仓库中的位置就是你最后一次连接到他们的位置。相当于远程上的分支。
* 如果不与 origin 服务器连接 (拉取数据)，本地的 origin/master 指针就不会移动
* 与给定的远程仓库**同步数据**：git fetch \<remote>，从 remote 中抓取本地没有的数据，并且更新本地数据库，移动 origin/master 指针到更新之后的位置

* 推送分支：git push \<remote> \<branch>，将本地的 \<branch> 分支推送到远程仓库的 \<branch> 分支中
* 合并分支：git merge origin/serverfix
* 在远程跟踪分支上创建本地跟踪分支：git checkout -b \<branch> origin/\<branch>

跟踪分支：
* 从一个远程跟踪分支检出一个本地分支会创建“跟踪分支”
* 在跟踪分支上运行 git pull，Git 能自动识别去哪个服务器上抓取、合并到哪个分支
* 当克隆仓库时，自动创建一个跟踪 origin/master 的 master 分支。
* 手动创建跟踪分支：
    - git checkout -b \<branch> \<remote>/\<branch>
    - git checkout --track origin/\<branch>
    - git checkout <branch> 当尝试检出的分支不存在且刚好只有一个名字与之匹配的远程分支
* 查看设置的所有跟踪分支：git branch -vv

拉取：
* git pull：一个git fetch 紧接着 git merge 命令

删除远程分支：
* 前提条件：通过远程分支做完了所有的工作----完成了一个特性，并且将其合并到远程仓库的 master 分支。
* 删除远程分支：git push 

### 5. 变基 (rebase)

整合分支的两种方法：merge 和 rebase

rebase：将提交到某一分支上所有修改移至另一分支上
* git rebase \<basebranch> \<topicbranch>

如果提交存在于你的仓库之外，而别人可能基于这些提交进行开发，那么不要执行变基。只对尚未推送或分享给别人的本地修改执行变基操作，从不对已推送到别处的提交执行变基操作。





