---
layout: post
title: Git 分支
categories: 版本控制
---


### 1. 分支简介

分支的目的：把工作从开发主线上分离开来


**暂存操作**会为每一个文件计算校验和 (SHA-1 算法)，并把当前版本的文件快照保存到 Git 仓库中 (**blob 对象**)，最终将校验和加入到暂存区域等待提交。

**blob**：Binary Large Object。blob 存储文件的数据，但是不包含文件的任何metadata。

**提交操作：**
* Git 会先计算每一个子目录的校验和，然后在 Git 仓库中将这些校验和保存为**树对象**。
* 随后，Git 便会创建一个**提交对象**， 它除了包含提交信息外，还包含指向这个树对象（项目根目录）的指针。 
* 提交对象有指向父提交对象的指针。普通提交产生的提交对象有一个父对象，而由多个分支合并产生的提交对象有多个父对象。

**git 中的对象：**
* blob 对象：保存文件快照
* 树对象：记录目录结构和 blob 对象索引
* 提交对象：指向树对象，指向父提交对象，包含提交信息。

### 2. 分支创建与切换

**Git 分支，本质上是指向提交对象的可变指针。**Git 创建分支时，只是创建了一个可以移动的新的指针。创建和销毁分支异常高效。

**分支有关的名称：**
* Git 的默认分支名字是 **master**。
* Git 利用特殊指针 **HEAD** 来指示当前在哪一个分支上。HEAD 指针指向当前所在的本地分支，为当前分支的别名。

**分支切换所完成的操作：**
* 使 HEAD 指向新分支
* 将工作目录恢复
    - **分支切换会改变工作目录中的文件**

**有关命令：**
* 分支创建：git branch 分支名
* 分支查看：git log --oneline --decorate
* 分支切换：git checkout 分支名
    - git checkout: switch branches or restore working tree files
    - git checkout 会更新 HEAD 指向新分支
* 创建分支并切换过去：git checkout -b 新分支名

### 3. 分支的合并与删除

在切换分支前，要留意工作目录和暂存区内还没有被提交的修改，可能和要切换到的分支产生冲突而阻止 Git 切换到该分支。最好是在切换分支前，保持一个干净的状态。

* 合并分支：git merge 分支名
* 删除分支：git branch -d 分支名
* 解决冲突的图形化工具：git mergetool

**fast-forward**：当你试图合并两个分支时， 如果顺着一个分支走下去能够到达另一个分支，那么 Git 在合并两者的时候， 只会简单的将指针**向前推进**（指针右移），因为这种情况下的合并操作没有需要解决的分歧

**三方合并**：当一个分支不是另一个分支的直接祖先，Git 会使用两个分支的末端所指的快照及公共祖先，做三方合并。Git 会创建一个新的快照，自动创建新的提交，叫做**合并提交**，该提交有不止一个父提交。

**合并冲突**：在不同分支中，对**同一文件的同一个部分**进行了不同的修改，导致没法合并。

未合并状态：因包含合并冲突而有待解决的文件

### 4. 分支开发工作流

长期分支：
* 同时拥有多个开放的分支，定期的把某些分支合并入其他分支中
* 例如，在 master 分支上保留完全稳定的代码，在 develop 分支上做后续开发

主题分支：
* 短期分支，实现单一特性或相关工作
* 多次创建、使用、合并、删除分支

### 5. 远程分支：

**远程引用：**
* 对**远程仓库**的引用，包括分支、标签等
* **origin** 是当你运行 git clone 时默认的远程仓库名字
* 添加远程仓库引用：git remote add \<remote>
* 使用 git ls-remote \<remote> 来显式的获得远程引用的完整列表。
* 使用 git remote show \<remote> 获得远程分支的具体信息

**远程跟踪分支：**
* 是远程分支状态的引用，以 **\<remote>/\<branch>** 命名，默认为 origin/master，该分支在远程仓库中的位置就是你最后一次连接到他们的位置。
* 如果不与 origin 服务器连接 (拉取数据)，本地的 origin/master 指针就不会移动

**跟踪分支：**
* 从一个远程跟踪分支检出一个本地分支会创建“跟踪分支”
* 在跟踪分支上运行 git pull，Git 能自动识别去哪个服务器上抓取、合并到哪个分支
* 当克隆仓库时，自动创建一个跟踪 origin/master 的 master 分支。
* **手动创建跟踪分支：**
    - git checkout -b \<branch> \<remote>/\<branch>
    - git checkout --track origin/\<branch>
    - git checkout <branch> 当尝试检出的分支不存在且刚好只有一个名字与之匹配的远程分支
* 查看设置的所有跟踪分支：git branch -vv

**相关命令：**
* 与给定的远程仓库**同步数据**：git fetch \<remote>
    - 会从 remote 中抓取本地没有的数据，移动 origin/master 指针到新的位置
* **推送分支**：git push \<remote> \<branch>，将本地的 \<branch> 分支推送到远程仓库的 \<branch> 分支中
    - Git 会自动将 branch 名字展开为 refs/heads/分支名:refs/heads/分支名
* **合并分支**：git merge origin/分支名
* git pull：一个git fetch 紧接着 git merge 命令
* 删除远程分支：git push origin --delete 分支名





